<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/WEB-INF/templates/layout.xhtml">
    <ui:define name="title">Gestion Produits - E-Commerce</ui:define>
    
    <ui:define name="content">
        <h2>Gestion des Produits</h2>
        
        <p:panel rendered="#{not internauteBean.admin and not internauteBean.vendeur}"
                 style="text-align: center; padding: 40px;">
            <i class="pi pi-lock" style="font-size: 4rem; color: #f44336;"/>
            <h3>Accès refusé</h3>
            <p>Vous n'avez pas les permissions nécessaires pour accéder à cette page.</p>
            <p:button value="Retour à l'accueil" outcome="/index.xhtml" 
                      styleClass="ui-button-primary"/>
        </p:panel>
        
        <h:form id="produitsForm" rendered="#{internauteBean.admin or internauteBean.vendeur}">
            <!-- Bouton pour ajouter un nouveau produit -->
            <p:commandButton value="Nouveau produit" 
                             icon="pi pi-plus"
                             onclick="PF('newProduitDialog').show();"
                             styleClass="ui-button-success"
                             style="margin-bottom: 20px;"/>
            
            <!-- Table des produits -->
            <p:dataTable id="produitsTable" 
                         value="#{produitBean.produits}" 
                         var="produit"
                         paginator="true" 
                         rows="10"
                         emptyMessage="Aucun produit"
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}">
                
                <p:column headerText="ID" style="width: 50px;">
                    <h:outputText value="#{produit.id}"/>
                </p:column>
                
                <p:column headerText="Libellé" sortBy="#{produit.libelle}" filterBy="#{produit.libelle}">
                    <h:outputText value="#{produit.libelle}"/>
                </p:column>
                
                <p:column headerText="Description">
                    <h:outputText value="#{produit.description}"/>
                </p:column>
                
                <p:column headerText="Prix" sortBy="#{produit.prix}" style="width: 100px;">
                    <h:outputText value="#{produit.prix}">
                        <f:convertNumber type="currency" currencySymbol="DH " 
                                       minFractionDigits="2" maxFractionDigits="2"/>
                    </h:outputText>
                </p:column>
                
                <p:column headerText="Stock" sortBy="#{produit.stock}" style="width: 80px; text-align: center;">
                    <h:outputText value="#{produit.stock}"/>
                </p:column>
                
                <p:column headerText="Actions" style="width: 220px; text-align: center;">
                    <p:commandButton icon="pi pi-pencil" 
                                     title="Modifier"
                                     styleClass="ui-button-warning ui-button-sm"
                                     update=":editProduitForm"
                                     oncomplete="PF('editProduitDialog').show();"
                                     style="margin-right: 5px;">
                        <f:setPropertyActionListener value="#{produit}" 
                                                    target="#{produitBean.selectedProduit}"/>
                    </p:commandButton>
                    
                    <p:commandButton value="Supprimer" 
                                     icon="pi pi-trash" 
                                     styleClass="ui-button-danger ui-button-sm"
                                     action="#{produitBean.deleteProduit(produit.id)}"
                                     update=":produitsForm:produitsTable :messages"
                                     title="Supprimer définitivement ce produit"/>
                </p:column>
            </p:dataTable>
        </h:form>
        
        <!-- Dialog pour nouveau produit -->
        <p:dialog header="Nouveau Produit" widgetVar="newProduitDialog" modal="true" 
                  showEffect="fade" hideEffect="fade" responsive="true" width="500">
            <h:form id="newProduitForm">
                <p:panelGrid columns="2" styleClass="ui-noborder">
                    <p:outputLabel for="libelle" value="Libellé *:"/>
                    <p:inputText id="libelle" value="#{produitBean.newProduit.libelle}" 
                                 required="true" style="width: 100%;"/>
                    
                    <p:outputLabel for="description" value="Description:"/>
                    <p:inputTextarea id="description" value="#{produitBean.newProduit.description}" 
                                     rows="3" style="width: 100%;"/>
                    
                    <p:outputLabel for="prix" value="Prix *:"/>
                    <p:inputNumber id="prix" value="#{produitBean.newProduit.prix}" 
                                   symbol=" DH" symbolPosition="s" decimalSeparator="," 
                                   thousandSeparator=" " minValue="0" required="true"/>
                    
                    <p:outputLabel for="stock" value="Stock *:"/>
                    <p:inputNumber id="stock" value="#{produitBean.newProduit.stock}" 
                                   decimalPlaces="0" minValue="0" required="true"/>
                    
                    <p:outputLabel for="imageUrl" value="URL Image:"/>
                    <p:inputText id="imageUrl" value="#{produitBean.newProduit.imageUrl}" 
                                 style="width: 100%;"/>
                </p:panelGrid>
                
                <div style="text-align: right; margin-top: 20px;">
                    <p:commandButton value="Annuler" 
                                     onclick="PF('newProduitDialog').hide();"
                                     styleClass="ui-button-outlined"
                                     type="button"
                                     style="margin-right: 10px;"/>
                    <p:commandButton value="Enregistrer" 
                                     icon="pi pi-save"
                                     action="#{produitBean.saveProduit()}"
                                     update=":produitsForm:produitsTable :messages"
                                     oncomplete="if (args &amp;&amp; !args.validationFailed) PF('newProduitDialog').hide();"
                                     styleClass="ui-button-success"/>
                </div>
            </h:form>
        </p:dialog>
        
        <!-- Dialog pour éditer produit -->
        <p:dialog header="Modifier Produit" widgetVar="editProduitDialog" modal="true" 
                  showEffect="fade" hideEffect="fade" responsive="true" width="500">
            <h:form id="editProduitForm">
                <p:panelGrid columns="2" styleClass="ui-noborder">
                    <p:outputLabel for="editLibelle" value="Libellé *:"/>
                    <p:inputText id="editLibelle" value="#{produitBean.selectedProduit.libelle}" 
                                 required="true" style="width: 100%;"/>
                    
                    <p:outputLabel for="editDescription" value="Description:"/>
                    <p:inputTextarea id="editDescription" value="#{produitBean.selectedProduit.description}" 
                                     rows="3" style="width: 100%;"/>
                    
                    <p:outputLabel for="editPrix" value="Prix *:"/>
                    <p:inputNumber id="editPrix" value="#{produitBean.selectedProduit.prix}" 
                                   symbol=" DH" symbolPosition="s" decimalSeparator="," 
                                   thousandSeparator=" " minValue="0" required="true"/>
                    
                    <p:outputLabel for="editStock" value="Stock *:"/>
                    <p:inputNumber id="editStock" value="#{produitBean.selectedProduit.stock}" 
                                   decimalPlaces="0" minValue="0" required="true"/>
                    
                    <p:outputLabel for="editImageUrl" value="URL Image:"/>
                    <p:inputText id="editImageUrl" value="#{produitBean.selectedProduit.imageUrl}" 
                                 style="width: 100%;"/>
                </p:panelGrid>
                
                <div style="text-align: right; margin-top: 20px;">
                    <p:commandButton value="Annuler" 
                                     onclick="PF('editProduitDialog').hide();"
                                     styleClass="ui-button-outlined"
                                     type="button"
                                     style="margin-right: 10px;"/>
                    <p:commandButton value="Mettre à jour" 
                                     icon="pi pi-save"
                                     action="#{produitBean.updateProduit()}"
                                     update=":produitsForm:produitsTable :messages"
                                     oncomplete="if (args &amp;&amp; !args.validationFailed) PF('editProduitDialog').hide();"
                                     styleClass="ui-button-warning"/>
                </div>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>
</html>

